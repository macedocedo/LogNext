<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!--=============== FAVICON ===============-->
  <link rel="shortcut icon" href="assets/img/favicon.png" type="image/x-icon">

  <!--=============== BOXICONS ===============-->
  <link rel="stylesheet" href="https://unpkg.com/boxicons@latest/css/boxicons.min.css">

  <!--=============== SWIPER CSS ===============--> 
  <link rel="stylesheet" href="./css/swiper-bundle.min.css">

  <!--=============== CSS ===============-->
  <link rel="stylesheet" href="./css/styles1.css">

  <title>AppLogNext</title>

  <style>
    /* Estilos para a rolagem horizontal */
    .horizontal-scroll-container {
      display: flex;
      overflow-x: auto;  /* Permite rolar horizontalmente */
      gap: 20px;  /* Espaço entre os itens */
      padding: 20px;
      scroll-snap-type: x mandatory;  /* Efeito de "snap" */
      width: 100vw;
      height: 88vh;
    }

    .horizontal-scroll-container::-webkit-scrollbar {
      height: 8px;
    }

    .horizontal-scroll-container::-webkit-scrollbar-thumb {
      background-color: #ffffff00;
      border-radius: 10px;
    }

    .grid-item {
      background-color: rgba(0, 0, 0, 0);
      border-radius: 8px;
      width: 92vw;
      max-width: 400px;
      height: 80vh;
      text-align: center;
      scroll-snap-align: start;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .grid-item img {
      width: 100%;
      height: 45%;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .grid-item h2 {
      font-size: 32px;
      margin-bottom: 10px;
    }

    .grid-item p {
      font-size: 18px;
      color: #000000;
      max-width: 90%;
      text-align: center;
    }

    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 500px;
      margin: auto;
    }

    label {
      display: block;
      margin-top: 12px;
      font-size: 16px;
      font-weight: bold;
    }

    select, input[type="number"], input[type="text"] {
      width: 100%;
      padding: 12px;
      margin-top: 5px;
      margin-bottom: 12px;
      border-radius: 8px;
      border: 1px solid #000000;
      font-size: 16px;
      box-sizing: border-box;
    }

    button {
      width: 100%;
      background-color: #949694;
      color: rgb(0, 0, 0);
      border: none;
      padding: 12px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a049;
    }

    .saved-data {
      margin-top: 30px;
    }

    .saved-data h2 {
      font-size: 20px;
      margin-bottom: 10px;
    }

    ul#data-list {
      list-style: none;
      padding: 0;
    }

    ul#data-list li {
      background: #828585;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      position: relative;
      font-size: 16px;
    }

    .action-btns {
      margin-top: 10px;
      display: flex;
      gap: 10px;
    }

    .action-btns button {
      flex: 1;
      font-size: 14px;
      padding: 8px;
    }
    
    .delete-btn {
      background-color: #e53835;
      color: #000;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .edit-btn {
      background-color: #45a049;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

li.selected {
  background-color: #a4d4ae;
  border: 2px solid #45a049;
  cursor: pointer;
}


  </style>
</head>
<body>

  <!--==================== HEADER ====================-->
  <header class="header" id="header">
    <nav class="nav container">
      <a href="index.html" class="nav__logo">
        <img src="assets/img/favicon.png" alt="" class="nav__logo-img"> 
        LogNext
      </a>

      <div class="nav__menu" id="nav-menu">
        <ul class="nav__list">
          <li class="nav__item"><a href="index.html" class="nav__link active-link">Início</a></li>
          <li class="nav__item"><a href="Filtro.html" class="nav__link">Filtro</a></li>
          <li class="nav__item"><a href="Estoque-Entrada.html" class="nav__link">Entrada</a></li>
          <li class="nav__item"><a href="Filtro.html" class="nav__link">Filtro</a></li>
        </ul>

        <div class="nav__close" id="nav-close">
          <i class='bx bx-x'></i>
        </div>

        <img src="assets/img/nav-light.png" alt="" class="nav__img">
      </div>
      <div class="nav__btns">
        <!-- Theme change button -->
        <i class='bx bx-moon change-theme' id="theme-button"></i>
        <!-- Toggle button -->
        <div class="nav__toggle" id="nav-toggle">
          <i class='bx bx-grid-alt'></i>
        </div>
      </div>
    </nav>
  </header>

  <!--==================== CONTEÚDO ====================-->
  <h1>Controle de Estoque</h1>

  <label for="item-name">Código do Produto:</label>
  <input type="text" id="item-name" placeholder="Item" required>

  <label for="quantity">Quantidade:</label>
  <input type="number" id="quantity" placeholder="Quantidade" required>

  <label for="valor">Valor:</label>
  <input type="text" id="valor" placeholder="R$ 0,00" required>

  <label for="notes">Observações:</label>
  <input type="text" id="notes" placeholder="Observações">

  <label for="operation-type">Operação:</label>
  <select id="operation-type" required>
    <option value="Entrada">Entrada</option>
  </select>

  <div style="display: flex; gap: 10px;">
    <button id="save-btn" onclick="saveStock()">Entrada</button>
    <button id="cancel-btn" onclick="cancelEdit()" style="display: none;">Cancelar</button>
  </div>

  <div class="saved-data">
    <h2>Histórico de Movimentações</h2>
    <ul id="data-list"></ul>
  </div>

  <script>
   let stockData = JSON.parse(localStorage.getItem("estoqueData")) || [];
let editIndex = -1;
let selectedIndex = -1; // índice do item selecionado

function formatCurrency(value) {
  value = value.replace(/\D/g, '');
  value = (parseFloat(value) / 100).toFixed(2) + '';
  value = value.replace(".", ",");
  value = value.replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.");
  return 'R$ ' + value;
}
const valorInput = document.getElementById('valor');

valorInput.addEventListener('input', (e) => {
  // Salva o cursor para tentar manter a posição após formatar
  let cursorPosition = valorInput.selectionStart;
  let originalLength = valorInput.value.length;

  // Remove tudo que não seja número
  let value = valorInput.value.replace(/\D/g, '');

  // Se estiver vazio, limpa o campo
  if (value.length === 0) {
    valorInput.value = '';
    return;
  }

  // Formata o valor como moeda
  value = (parseInt(value) / 100).toFixed(2);

  // Troca ponto por vírgula para moeda BR
  value = value.replace('.', ',');

  // Insere os milhares
  value = value.replace(/\B(?=(\d{3})+(?!\d))/g, '.');

  valorInput.value = 'R$ ' + value;

  // Ajusta a posição do cursor para não pular no meio da digitação
  let newLength = valorInput.value.length;
  cursorPosition = cursorPosition + (newLength - originalLength);
  valorInput.setSelectionRange(cursorPosition, cursorPosition);
});

function saveStock() {
  const name = document.getElementById('item-name').value.trim();
  const quantity = parseInt(document.getElementById('quantity').value);
  let valorInput = document.getElementById('valor').value;
  const notes = document.getElementById('notes').value;
  const operation = document.getElementById('operation-type').value;
  const date = new Date().toLocaleString();

  if (!name || !quantity || !valorInput || !operation) {
    alert('Preencha todos os campos obrigatórios!');
    return;
  }

  const valor = formatCurrency(valorInput);

  const lastEntry = [...stockData].reverse().find(item => item.name === name);

  if (lastEntry && lastEntry.operation === operation && editIndex === -1) {
    alert(`O produto "${name}" já teve uma "${operation}". Registre a operação oposta.`);
    return;
  }

  const entry = { name, quantity, valor, notes, operation, date };

  if (editIndex === -1) {
    stockData.push(entry);
  } else {
    stockData[editIndex] = entry;
    editIndex = -1;
    selectedIndex = -1;
    document.getElementById('save-btn').textContent = 'Adicionar';
    document.getElementById('cancel-btn').style.display = 'none';
  }

  localStorage.setItem("estoqueData", JSON.stringify(stockData));
  updateStockList();
  clearInputs();
}

function loadStockToForm(index) {
  const item = stockData[index];
  document.getElementById('item-name').value = item.name;
  document.getElementById('quantity').value = item.quantity;
  // Para o campo valor, converte "R$ 1.234,56" para "1234.56" (formato numérico para edição)
  let valorParaEditar = item.valor.replace("R$ ", "").replace(/\./g, "").replace(",", ".");
  document.getElementById('valor').value = valorParaEditar;
  document.getElementById('notes').value = item.notes || '';
  document.getElementById('operation-type').value = item.operation;

  editIndex = index;
  selectedIndex = index;
  document.getElementById('save-btn').textContent = 'Salvar Alterações';
  document.getElementById('cancel-btn').style.display = 'inline-block';

  updateStockList();
}


function cancelEdit() {
  editIndex = -1;
  selectedIndex = -1;
  clearInputs();
  document.getElementById('save-btn').textContent = 'Adicionar';
  document.getElementById('cancel-btn').style.display = 'none';
  updateStockList();
}

function deleteStock(index) {
  if (confirm('Deseja excluir este item?')) {
    stockData.splice(index, 1);
    localStorage.setItem("estoqueData", JSON.stringify(stockData));
    selectedIndex = -1; // remover seleção ao excluir
    if (editIndex === index) {
      cancelEdit();
    } else {
      updateStockList();
    }
  }
}

function clearInputs() {
  document.getElementById('item-name').value = '';
  document.getElementById('quantity').value = '';
  document.getElementById('valor').value = '';
  document.getElementById('notes').value = '';
  document.getElementById('operation-type').selectedIndex = 0;
}

function updateStockList() {
  const list = document.getElementById('data-list');
  list.innerHTML = '';

  stockData.forEach((item, index) => {
    if (item.operation === 'Entrada' || item.operation === 'Saída') {
      const li = document.createElement('li');
      li.className = (index === selectedIndex) ? 'selected' : '';
      // Quando clicar no item, carrega os dados para editar
      li.onclick = () => loadStockToForm(index);

      const icon = '📥';
      li.innerHTML = `
        ${icon} <strong>${item.operation}</strong> — ${item.name}<br>
        🗓️ ${item.date}<br>
        🔢 Quantidade: ${item.quantity}<br>
        💰 Valor: ${item.valor}<br>
        📝 ${item.notes || 'Sem observações'}
        <div class="action-btns">
          <button class="edit-btn" onclick="event.stopPropagation(); loadStockToForm(${index})">Editar</button>
          <button class="delete-btn" onclick="event.stopPropagation(); deleteStock(${index})">Excluir</button>
        </div>
      `;
      list.appendChild(li);
    }
  });
}

document.addEventListener("DOMContentLoaded", function () {
  updateStockList();
});

  </script>

  <!--=============== SCROLL REVEAL ===============-->
  <script src="./js/scrollreveal.min.js"></script>

  <!--=============== SWIPER JS ===============-->
  <script src="./js/swiper-bundle.min.js"></script>

  <!--=============== MAIN JS ===============-->
  <script src="./js/main.js"></script>
</body>
</html>
